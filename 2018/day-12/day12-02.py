#!/usr/bin/env python
# -*- coding: utf-8 -*-

#
# Solution for https://adventofcode.com/2018/day/12
#

from collections import defaultdict

f = open("day12-input.txt")
lines = f.read().split("\n")

state = ""
changes = {}

# parse input
for line in lines:
    if "initial state" in line:
        state = line.split(" ")[2]
    elif "=>" in line:
        changes[line.split()[0]] = line.split()[2]

firstpot = 0
for n in range(200):
    newstate = ""
    for i in range(-5, len(state) + 5):
        match = ""
        for j in range(i - 2, i + 3):
            if j < 0 or j >= len(state):
                match = match + "."
            else:
                match = match + state[j]

        if match in changes.keys():
            newstate = newstate + changes[match]
        else:
            newstate = newstate + "."

    state = newstate
    firstpot = firstpot - 5

    total = 0
    pot = firstpot
    for i in range(len(state)):
        if state[i] == "#":
            total = total + pot

        pot = pot + 1

    print "#", n + 1, "=", total, "|", state.strip(".")

# the pattern repeats after iteration 184, and the total is increased by 42 in
# each iteration

# 180 = 8876 | ##.##....##..#......##..#......##..#......##..#....##..#.......##..#......##..#....##..#.....##..#......##..#......##..#....##..#....##..#
# 181 = 8636 | ##.....##..#......##..#......##..#......##..#....##..#.......##..#......##..#....##..#.....##..#......##..#......##..#....##..#....##..#
# 182 = 8533 | #......##..#......##..#......##..#......##..#....##..#.......##..#......##..#....##..#.....##..#......##..#......##..#....##..#....##..#
# 183 = 8715 | #.#......##..#......##..#......##..#......##..#....##..#.......##..#......##..#....##..#.....##..#......##..#......##..#....##..#....##..#
# 184 = 8896 | ##..#......##..#......##..#......##..#......##..#....##..#.......##..#......##..#....##..#.....##..#......##..#......##..#....##..#....##..#
# 185 = 8938 | ##..#......##..#......##..#......##..#......##..#....##..#.......##..#......##..#....##..#.....##..#......##..#......##..#....##..#....##..#
# 186 = 8980 | ##..#......##..#......##..#......##..#......##..#....##..#.......##..#......##..#....##..#.....##..#......##..#......##..#....##..#....##..#
# 187 = 9022 | ##..#......##..#......##..#......##..#......##..#....##..#.......##..#......##..#....##..#.....##..#......##..#......##..#....##..#....##..#
# 188 = 9064 | ##..#......##..#......##..#......##..#......##..#....##..#.......##..#......##..#....##..#.....##..#......##..#......##..#....##..#....##..#
# 189 = 9106 | ##..#......##..#......##..#......##..#......##..#....##..#.......##..#......##..#....##..#.....##..#......##..#......##..#....##..#....##..#
# 190 = 9148 | ##..#......##..#......##..#......##..#......##..#....##..#.......##..#......##..#....##..#.....##..#......##..#......##..#....##..#....##..#

# so the item at #pos will be
# 8896 + (pos - 184) * 42

pos = 50000000000L
print "#", pos, "=", 8896 + (pos - 184) * 42